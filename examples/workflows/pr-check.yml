name: Check Citation Consistency
on:
  pull_request:
    paths:
      - 'pyproject.toml'
      - 'CITATION.cff'

jobs:
  check-citation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Check CITATION.cff consistency
        id: citation-check
        uses: your-username/citation-sync@v1
        with:
          validate-only: true
      
      - name: Comment on PR if changes needed
        if: steps.citation-check.outputs.changes-detected == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `⚠️ **CITATION.cff Sync Warning**
              
              The \`CITATION.cff\` file appears to be out of sync with \`pyproject.toml\` metadata.
              
              **Recommended Action:**
              Consider running the citation-sync action to update your citation file:
              \`\`\`yaml
              - name: Sync CITATION.cff
                uses: your-username/citation-sync@v1
                with:
                  commit: true
              \`\`\`
              
              Or run it locally with the provided Python script.`
            })
      
      - name: Fail if validation errors
        if: steps.citation-check.outputs.validation-status == 'invalid'
        run: |
          echo "❌ CITATION.cff validation failed"
          exit 1